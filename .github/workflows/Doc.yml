name: 'Documentation'

on:
  push:
  pull_request:
  workflow_dispatch:

jobs:

  BTD:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        include:
        - { format: html,     branch: gh-pages }
        - { format: markdown, branch: documentation-markdown }
    name: 'ðŸ““ Docs | ${{ matrix.format }}'

    steps:

    - name: 'ðŸ§° Checkout'
      uses: actions/checkout@v2

    - name: 'ðŸ““ Generate documentation ${{ matrix.format }}'
      uses: ./
      with:
        format: ${{ matrix.format }}

    - name: 'ðŸ“¤ Upload artifact: ${{ matrix.format }}'
      uses: actions/upload-artifact@master
      with:
        name: documentation-${{ matrix.format }}
        path: teroshdl_doc

    - name: 'ðŸš€ Deploy'
      if: github.event_name != 'pull_request' && (github.ref == 'refs/heads/main' || contains(github.ref, 'refs/tags/'))
      uses: JamesIves/github-pages-deploy-action@4.1.4
      with:
        branch: ${{ matrix.branch }}
        folder: teroshdl_doc
